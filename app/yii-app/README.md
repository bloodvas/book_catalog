# Каталог книг - Yii 1.0 Application

Тестовое задание: каталог книг на фреймворке Yii 1.0 + MySQL с функционалом подписки на авторов и SMS-уведомлениями.

## Функционал

### Основной функционал
- **Каталог книг**: просмотр, добавление, редактирование, удаление
- **Авторы**: управление списком авторов
- **Множественные авторы**: у книги может быть несколько авторов
- **Подписки**: гости могут подписаться на уведомления о новых книгах автора
- **SMS-уведомления**: автоматическая отправка SMS при добавлении новых книг
- **Отчеты**: ТОП-10 авторов по количеству книг за год

### Права доступа
- **Гость**: просмотр книг/авторов, подписка на авторов, просмотр отчетов
- **Пользователь**: полный CRUD для книг и авторов, все функции гостя

## Установка и настройка

### 1. Настройка базы данных
```bash
# Выполнить миграции
cd protected
php yiic migrate
```

### 2. Настройка веб-сервера
DocumentRoot должен указывать на директорию с приложением.

### 3. Настройка SMSpilot (опционально)
В файле `protected/config/main.php` изменить настройки:
```php
'smspilot'=>array(
    'class'=>'SMSpilot',
    'apiKey'=>'YOUR_REAL_API_KEY', // Заменить EMULATOR на реальный ключ
    'sender'=>'BookCatalog',
    'testMode'=>false, // Выключить для продакшена
),
```

## Структура приложения

```
protected/
├── components/
│   ├── AccessControl.php      # Контроль доступа
│   ├── BookObserver.php       # Наблюдатель за книгами
│   ├── Controller.php         # Базовый контроллер
│   ├── SMSNotificationService.php # Сервис SMS-уведомлений
│   ├── SMSpilot.php          # API SMSpilot
│   └── WebUser.php           # Компонент пользователя
├── controllers/
│   ├── AuthorController.php   # CRUD авторов
│   ├── BookController.php     # CRUD книг
│   ├── ReportController.php   # Отчеты
│   ├── SiteController.php     # Основной контроллер
│   ├── SmsController.php      # Управление SMS
│   └── SubscriptionController.php # Подписки
├── migrations/               # Миграции БД
├── models/
│   ├── Author.php           # Модель автора
│   ├── Book.php             # Модель книги
│   ├── BookAuthor.php       # Связь книга-автор
│   ├── ReportForm.php       # Форма фильтров отчетов
│   ├── Subscription.php     # Модель подписки
│   └── User.php            # Модель пользователя
└── views/                  # Шаблоны представлений
```

## API Endpoints

### Книги
- `GET /book/index` - список книг
- `GET /book/view/{id}` - просмотр книги
- `GET /book/create` - форма создания (только пользователи)
- `POST /book/create` - создание книги (только пользователи)
- `GET /book/update/{id}` - форма редактирования (только пользователи)
- `POST /book/update/{id}` - обновление книги (только пользователи)
- `POST /book/delete/{id}` - удаление книги (только пользователи)

### Авторы
- `GET /author/index` - список авторов
- `GET /author/view/{id}` - просмотр автора с книгами
- `GET /author/create` - форма создания (только пользователи)
- `POST /author/create` - создание автора (только пользователи)
- `GET /author/update/{id}` - форма редактирования (только пользователи)
- `POST /author/update/{id}` - обновление автора (только пользователи)
- `POST /author/delete/{id}` - удаление автора (только пользователи)

### Подписки
- `GET /subscription/subscribe/{author_id}` - форма подписки (только гости)
- `POST /subscription/subscribe/{author_id}` - оформление подписки (только гости)
- `GET /subscription/admin` - управление подписками (только пользователи)

### Отчеты
- `GET /report/index` - список доступных отчетов
- `GET /report/topAuthors` - ТОП-10 авторов за год
- `GET /report/exportTopAuthors` - экспорт отчета в CSV

### SMS
- `GET /sms/test` - тестирование SMS (только пользователи)
- `GET /sms/balance` - проверка баланса (только пользователи)

## База данных

### Таблицы
- `authors` - авторы
- `books` - книги
- `book_authors` - связь книг и авторов (многие-ко-многим)
- `subscriptions` - подписки гостей на авторов
- `users` - пользователи системы

## Тестирование

### Тестовый пользователь
- Логин: `admin`
- Пароль: `admin123`

### Тестирование SMS
Для тестирования используется ключ `EMULATOR` - реальная отправка SMS не происходит.

## Возможности для расширения

### Фильтры отчетов
- Фильтр по жанру (подготовлено в модели ReportForm)
- Фильтр по издательству
- Фильтр по диапазону количества книг

### Дополнительные типы отчетов
- Статистика по жанрам
- Динамика изданий по годам
- Отчет по подписчикам

### Расширение SMS-функционала
- Email-уведомления
- Push-уведомления
- Шаблоны сообщений

## Технологии

- **PHP 8+**
- **Yii Framework 1.1**
- **MySQL/MariaDB**
- **SMSpilot API** для SMS-уведомлений

## Время выполнения

Задание выполнено в рамках 8 часов как требовалось.
