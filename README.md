# Каталог книг

Система управления каталогом книг с возможностью подписки на SMS-уведомления о новых книгах авторов.

## О проекте

Каталог книг - это веб-приложение для управления библиотекой книг и авторов с возможностью подписки на уведомления. Система разработана на фреймворке Yii 1.0 с использованием Docker для развертывания.

### Основные возможности:

- **Управление книгами**: Создание, чтение, обновление, удаление книг
- **Управление авторами**: CRUD операции с авторами
- **Множественные авторы**: Одна книга может иметь нескольких авторов
- **SMS-уведомления**: Подписка на уведомления о новых книгах через SMS
- **Отчеты**: ТОП-10 авторов по количеству книг с экспортом в CSV
- **Разграничение доступа**: Гости и авторизованные пользователи
- **Поиск и фильтрация**: Поиск книг и авторов с различными фильтрами

### Технологический стек:

- **Backend**: PHP 8.4, Yii Framework 1.1.32
- **База данных**: MySQL 8.0
- **Веб-сервер**: Nginx
- **Контейнеризация**: Docker & Docker Compose
- **Очереди**: RabbitMQ
- **Кэширование**: Redis
- **SMS-сервис**: SMSpilot API

## Установка и запуск

### Требования:

- Docker
- Docker Compose
- Git

### Шаги по установке:

1. **Клонирование репозитория:**
   ```bash
   git clone <repository-url>
   cd book_catalog
   ```

2. **Запуск контейнеров:**
   ```bash
   docker compose up -d
   ```

3. **Проверка статуса контейнеров:**
   ```bash
   docker compose ps
   ```

4. **Доступ к приложению:**
   - Веб-интерфейс: http://localhost:8880
   - База данных: localhost:8110 (root/root)
   - Redis: localhost:6379
   - RabbitMQ Management: http://localhost:15672

### Структура проекта:

```
book_catalog/
├── app/
│   ├── yii-app/              # Основное приложение Yii
│   │   ├── protected/        # Защищенные файлы приложения
│   │   │   ├── controllers/  # Контроллеры
│   │   │   ├── models/       # Модели данных
│   │   │   ├── views/        # Шаблоны представлений
│   │   │   └── components/   # Компоненты
│   │   └── index.php         # Точка входа
│   └── basic/                # Yii framework
├── _docker/                  # Конфигурации Docker
│   ├── nginx/                # Конфигурация Nginx
│   └── app/                  # Конфигурация PHP
├── docker-compose.yaml       # Docker Compose конфигурация
└── README.md                 # Этот файл
```

## Работа с системой

### Роли пользователей:

#### Гости (неавторизованные пользователи):
- Просмотр списка книг и авторов
- Просмотр детальной информации о книгах и авторах
- Подписка на SMS-уведомления о новых книгах
- Просмотр отчетов (ТОП-10 авторов)
- Доступ к странице "О проекте"

#### Администраторы (авторизованные пользователи):
- Все возможности гостей
- Создание, редактирование, удаление книг
- Создание, редактирование, удаление авторов
- Управление подписками
- Просмотр всех отчетов
- Экспорт отчетов в CSV

### Основные URL:

- **Главная страница**: http://localhost:8880/index.php?r=site/index
- **Книги**: http://localhost:8880/index.php?r=book/index
- **Авторы**: http://localhost:8880/index.php?r=author/index
- **Подписки**: http://localhost:8880/index.php?r=subscription/index
- **Отчеты**: http://localhost:8880/index.php?r=report/topAuthors
- **О проекте**: http://localhost:8880/index.php?r=site/page&view=about

### Аутентификация:

- **Логин**: admin
- **Пароль**: admin

### Подписка на SMS-уведомления:

1. Перейдите на страницу автора
2. Нажмите кнопку "Подписаться"
3. Введите номер телефона в формате +79991234567
4. Подтвердите подписку

### Экспорт отчетов:

1. Перейдите в раздел "Отчеты"
2. Выберите фильтры (период, авторы)
3. Нажмите "Экспортировать в CSV"

## API и интеграции

### SMS-уведомления:

Система интегрирована с SMSpilot API для отправки SMS-уведомлений. Для настройки:

1. Установите API ключ в конфигурации
2. Настройте шаблоны сообщений
3. Проверьте баланс SMS

### База данных:

Основные таблицы:
- `books` - книги
- `authors` - авторы
- `book_authors` - связь книг и авторов
- `subscriptions` - подписки на уведомления
- `users` - пользователи системы

## Разработка

### Локальная разработка:

1. Запустите контейнеры: `docker compose up -d`
2. Просмотрите логи: `docker compose logs -f app`
3. Перезапустите сервис: `docker compose restart app`

### Миграции базы данных:

Миграции выполняются автоматически при первом запуске.

### Отладка:

- Логи приложения: `docker compose logs app`
- Логи Nginx: `docker compose logs nginx`
- Логи базы данных: `docker compose logs db`

## Тестирование

### Функциональное тестирование:

1. Проверьте доступность сайта: http://localhost:8880
2. Протестируйте CRUD операции для книг и авторов
3. Проверьте работу подписок
4. Протестируйте экспорт отчетов

### Тестирование SMS-уведомлений:

1. Создайте тестовую подписку
2. Добавьте новую книгу для автора
3. Проверьте получение SMS

## Обслуживание

### Резервное копирование:

```bash
# Резервное копирование базы данных
docker exec book_catalog_db mysqldump -u root -proot book_catalog > backup.sql

# Восстановление базы данных
docker exec -i book_catalog_db mysql -u root -proot book_catalog < backup.sql
```

### Обновление:

1. Остановите контейнеры: `docker compose down`
2. Обновите код: `git pull`
3. Пересоберите образы: `docker compose build --no-cache`
4. Запустите контейнеры: `docker compose up -d`

## Безопасность

- Все пользовательские входы фильтруются
- SQL-инъекции предотвращены через подготовленные запросы
- XSS-атаки предотвращены через экранирование вывода
- CSRF-защита включена для форм
- Загрузка файлов ограничена по размеру (50MB)

## Траблшутинг

### Частые проблемы:

1. **Контейнеры не запускаются:**
   ```bash
   docker compose down
   docker compose up -d
   ```

2. **Ошибка 404:**
   - Проверьте, что все контейнеры запущены
   - Проверьте права доступа в AccessControl.php

3. **Ошибка 500:**
   - Посмотрите логи: `docker compose logs app`
   - Проверьте конфигурацию PHP и Nginx

4. **Проблемы с базой данных:**
   - Проверьте подключение: `docker compose exec db mysql -u root -p`
   - Проверьте наличие таблиц: `show tables;`

## Лицензия

Проект распространяется под лицензией MIT.

## Контакты

Для вопросов и предложений свяжитесь с командой разработки.
